{% extends "base.html" %}

{% block title %}Subscription - Digitallab CV Creator{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12 text-center mb-5">
            <h1 class="h2 fw-bold text-primary">Choose Your Plan</h1>
            <p class="lead text-muted">Unlock the full potential of your professional CV</p>
        </div>
    </div>

    <!-- Current Status -->
    <div class="row mb-5">
        <div class="col-md-8 mx-auto">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-3 text-center mb-3 mb-md-0">
                            {% if user.profile_image_url %}
                                <img src="{{ user.profile_image_url }}" alt="Profile" class="rounded-circle border border-3" style="width: 80px; height: 80px; object-fit: cover;">
                            {% else %}
                                <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 80px; height: 80px;">
                                    <i class="fas fa-user fa-2x text-primary"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <h5 class="fw-bold mb-2">{{ user.first_name or 'User' }} {{ user.last_name or '' }}</h5>
                            <p class="text-muted mb-1">{{ user.email }}</p>
                            
                            {% if user.is_trial_active %}
                                <div class="badge bg-warning text-dark">
                                    <i class="fas fa-clock me-1"></i>Free Trial: {{ user.trial_days_left }} days left
                                </div>
                            {% elif user.subscription_active %}
                                <div class="badge bg-success">
                                    <i class="fas fa-crown me-1"></i>Pro Member
                                </div>
                            {% else %}
                                <div class="badge bg-danger">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Trial Expired
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-3 text-center">
                            <h3 class="fw-bold text-primary mb-1">{{ user.cvs|length }}</h3>
                            <p class="text-muted small mb-0">CVs Created</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pricing Plans -->
    <div class="row justify-content-center">
        <!-- Free Trial Card -->
        <div class="col-lg-5 col-md-6 mb-4">
            <div class="card border-2 h-100 {% if user.is_trial_active %}border-warning{% else %}border-light{% endif %}">
                <div class="card-header {% if user.is_trial_active %}bg-warning text-dark{% else %}bg-light{% endif %} text-center py-4">
                    <h3 class="card-title mb-2">Free Trial</h3>
                    <p class="card-text mb-0">7 days to explore all features</p>
                </div>
                <div class="card-body text-center p-4">
                    <div class="price mb-4">
                        <span class="h1 fw-bold">$0</span>
                        <span class="text-muted">/week</span>
                    </div>

                    <ul class="list-unstyled text-start mb-4">
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Unlimited CV Creation</strong>
                            <br><small class="text-muted ms-4">Create as many CVs as you need</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>QR Code Generation</strong>
                            <br><small class="text-muted ms-4">Instant sharing with QR codes</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Professional Templates</strong>
                            <br><small class="text-muted ms-4">Beautiful, modern CV designs</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Cloud Storage</strong>
                            <br><small class="text-muted ms-4">Access your CVs from anywhere</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Mobile Responsive</strong>
                            <br><small class="text-muted ms-4">Perfect on all devices</small>
                        </li>
                    </ul>

                    {% if user.is_trial_active %}
                        <div class="alert alert-warning">
                            <i class="fas fa-clock me-2"></i>
                            <strong>{{ user.trial_days_left }} days remaining</strong>
                        </div>
                        <button class="btn btn-warning btn-lg w-100" disabled>
                            <i class="fas fa-clock me-2"></i>Trial Active
                        </button>
                    {% elif user.subscription_active %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            You're already a Pro member!
                        </div>
                        <button class="btn btn-secondary btn-lg w-100" disabled>
                            <i class="fas fa-check me-2"></i>Trial Used
                        </button>
                    {% else %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Trial has expired
                        </div>
                        <button class="btn btn-secondary btn-lg w-100" disabled>
                            <i class="fas fa-times me-2"></i>Trial Expired
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Pro Plan Card -->
        <div class="col-lg-5 col-md-6 mb-4">
            <div class="card border-2 border-primary h-100 position-relative">
                <!-- Popular Badge -->
                <div class="position-absolute top-0 start-50 translate-middle">
                    <span class="badge bg-primary px-3 py-2">RECOMMENDED</span>
                </div>
                
                <div class="card-header bg-primary text-white text-center py-4">
                    <h3 class="card-title mb-2">Pro Plan</h3>
                    <p class="card-text mb-0">Full access to all features</p>
                </div>
                <div class="card-body text-center p-4">
                    <div class="price mb-4">
                        <span class="h1 fw-bold">$9.99</span>
                        <span class="text-muted">/month</span>
                    </div>

                    <ul class="list-unstyled text-start mb-4">
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Everything in Free Trial</strong>
                            <br><small class="text-muted ms-4">All features included</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Unlimited Storage</strong>
                            <br><small class="text-muted ms-4">Never worry about limits</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Premium Templates</strong>
                            <br><small class="text-muted ms-4">Exclusive professional designs</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Analytics & Insights</strong>
                            <br><small class="text-muted ms-4">Track CV views and engagement</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Priority Support</strong>
                            <br><small class="text-muted ms-4">Get help when you need it</small>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-3"></i>
                            <strong>Custom Branding</strong>
                            <br><small class="text-muted ms-4">Remove Digitallab branding</small>
                        </li>
                    </ul>

                    {% if user.subscription_active %}
                        <div class="alert alert-success">
                            <i class="fas fa-crown me-2"></i>
                            <strong>You're a Pro member!</strong>
                        </div>
                        <button class="btn btn-success btn-lg w-100" disabled>
                            <i class="fas fa-crown me-2"></i>Current Plan
                        </button>
                    {% else %}
                        <form method="POST" action="{{ url_for('create_checkout_session') }}">
                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-crown me-2"></i>Upgrade to Pro
                            </button>
                        </form>
                        <p class="small text-muted mt-3 mb-0">
                            <i class="fas fa-shield-alt me-1"></i>
                            Secure payment powered by Stripe
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Features Comparison -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-center fw-bold text-primary mb-4">Feature Comparison</h3>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th scope="col" class="fw-bold">Features</th>
                            <th scope="col" class="text-center fw-bold">Free Trial</th>
                            <th scope="col" class="text-center fw-bold text-primary">Pro Plan</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><i class="fas fa-file-alt me-2 text-primary"></i>CV Creation</td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-qrcode me-2 text-primary"></i>QR Code Sharing</td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-palette me-2 text-primary"></i>Professional Templates</td>
                            <td class="text-center">Basic</td>
                            <td class="text-center">Premium</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-cloud me-2 text-primary"></i>Cloud Storage</td>
                            <td class="text-center">Limited</td>
                            <td class="text-center">Unlimited</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-chart-bar me-2 text-primary"></i>Analytics</td>
                            <td class="text-center"><i class="fas fa-times text-danger"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-headset me-2 text-primary"></i>Priority Support</td>
                            <td class="text-center"><i class="fas fa-times text-danger"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-crown me-2 text-primary"></i>Custom Branding</td>
                            <td class="text-center"><i class="fas fa-times text-danger"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- FAQ Section -->
    <div class="row mt-5">
        <div class="col-md-8 mx-auto">
            <h3 class="text-center fw-bold text-primary mb-4">Frequently Asked Questions</h3>
            <div class="accordion" id="faqAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq1">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                            Can I cancel my subscription anytime?
                        </button>
                    </h2>
                    <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Yes! You can cancel your Pro subscription at any time. You'll continue to have access to Pro features until the end of your current billing period.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq2">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                            What happens to my CVs if I don't subscribe?
                        </button>
                    </h2>
                    <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Your existing CVs will remain accessible and their public links will continue to work. However, you won't be able to create new CVs or edit existing ones without an active subscription.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq3">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                            Is my payment information secure?
                        </button>
                    </h2>
                    <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Absolutely! We use Stripe for payment processing, which is industry-standard for security. We never store your payment information on our servers.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Add animation to pricing cards
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.card');
    
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            if (!this.classList.contains('border-primary')) return;
            this.style.transform = 'scale(1.02)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
});
</script>
{% endblock %}