{% extends "base.html" %}

{% block title %}{{ 'Edit CV' if edit_mode else 'Create CV' }} - Digitallab CV Creator{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex align-items-center mb-4">
                <a href="{{ url_for('home') }}" class="btn btn-outline-secondary me-3">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h1 class="h2 fw-bold text-primary mb-0">{{ 'Edit CV' if edit_mode else 'Create New CV' }}</h1>
            </div>
        </div>
    </div>

    <form method="POST" id="cvForm">
        <div class="row">
            <!-- Form Column -->
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <!-- Basic Information -->
                        <div class="section-header mb-4">
                            <h4 class="fw-bold text-primary">
                                <i class="fas fa-user me-2"></i>Basic Information
                            </h4>
                            <hr class="mt-2">
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label for="title" class="form-label fw-semibold">CV Title *</label>
                                <input type="text" class="form-control" id="title" name="title" 
                                       value="{{ cv.title if edit_mode else '' }}" 
                                       placeholder="e.g., Senior Software Engineer Resume" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="full_name" class="form-label fw-semibold">Full Name *</label>
                                <input type="text" class="form-control" id="full_name" name="full_name" 
                                       value="{{ cv.full_name if edit_mode else '' }}" 
                                       placeholder="John Doe" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="email" class="form-label fw-semibold">Email *</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       value="{{ cv.email if edit_mode else '' }}" 
                                       placeholder="john@example.com" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="phone" class="form-label fw-semibold">Phone</label>
                                <input type="tel" class="form-control" id="phone" name="phone" 
                                       value="{{ cv.phone if edit_mode else '' }}" 
                                       placeholder="+1 (555) 123-4567">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="address" class="form-label fw-semibold">Address</label>
                                <input type="text" class="form-control" id="address" name="address" 
                                       value="{{ cv.address if edit_mode else '' }}" 
                                       placeholder="City, State, Country">
                            </div>
                            
                            <div class="col-12">
                                <label for="summary" class="form-label fw-semibold">Professional Summary</label>
                                <textarea class="form-control" id="summary" name="summary" rows="4" 
                                          placeholder="Brief overview of your professional background and key achievements...">{{ cv.summary if edit_mode else '' }}</textarea>
                            </div>
                        </div>

                        <!-- Professional Links -->
                        <div class="section-header mb-4">
                            <h4 class="fw-bold text-primary">
                                <i class="fas fa-link me-2"></i>Professional Links
                            </h4>
                            <hr class="mt-2">
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <label for="website_url" class="form-label fw-semibold">
                                    <i class="fas fa-globe me-1"></i>Website
                                </label>
                                <input type="url" class="form-control" id="website_url" name="website_url" 
                                       value="{{ cv.website_url if edit_mode else '' }}" 
                                       placeholder="https://yourwebsite.com">
                            </div>
                            
                            <div class="col-md-4">
                                <label for="linkedin_url" class="form-label fw-semibold">
                                    <i class="fab fa-linkedin me-1"></i>LinkedIn
                                </label>
                                <input type="url" class="form-control" id="linkedin_url" name="linkedin_url" 
                                       value="{{ cv.linkedin_url if edit_mode else '' }}" 
                                       placeholder="https://linkedin.com/in/username">
                            </div>
                            
                            <div class="col-md-4">
                                <label for="github_url" class="form-label fw-semibold">
                                    <i class="fab fa-github me-1"></i>GitHub
                                </label>
                                <input type="url" class="form-control" id="github_url" name="github_url" 
                                       value="{{ cv.github_url if edit_mode else '' }}" 
                                       placeholder="https://github.com/username">
                            </div>
                        </div>

                        <!-- Experience -->
                        <div class="section-header mb-4">
                            <h4 class="fw-bold text-primary">
                                <i class="fas fa-briefcase me-2"></i>Work Experience
                            </h4>
                            <hr class="mt-2">
                        </div>
                        
                        <div class="mb-4">
                            <label for="experience" class="form-label fw-semibold">Experience Details</label>
                            <textarea class="form-control" id="experience" name="experience" rows="6" 
                                      placeholder="Job Title | Company Name | Start Date - End Date
• Key achievement or responsibility
• Another achievement with specific metrics
• Third achievement showing impact

Job Title | Company Name | Start Date - End Date
• Key achievement or responsibility
• Another achievement with specific metrics">{{ cv.experience if edit_mode else '' }}</textarea>
                            <div class="form-text">Format: Job Title | Company | Dates, then list achievements with bullet points.</div>
                        </div>

                        <!-- Education -->
                        <div class="section-header mb-4">
                            <h4 class="fw-bold text-primary">
                                <i class="fas fa-graduation-cap me-2"></i>Education
                            </h4>
                            <hr class="mt-2">
                        </div>
                        
                        <div class="mb-4">
                            <label for="education" class="form-label fw-semibold">Education Details</label>
                            <textarea class="form-control" id="education" name="education" rows="4" 
                                      placeholder="Degree | Institution | Year
• Relevant coursework or achievements
• GPA (if impressive): 3.8/4.0
• Honors or awards

Certificate | Institution | Year">{{ cv.education if edit_mode else '' }}</textarea>
                            <div class="form-text">Format: Degree | Institution | Year, then list relevant details.</div>
                        </div>

                        <!-- Skills -->
                        <div class="section-header mb-4">
                            <h4 class="fw-bold text-primary">
                                <i class="fas fa-cogs me-2"></i>Skills
                            </h4>
                            <hr class="mt-2">
                        </div>
                        
                        <div class="mb-4">
                            <label for="skills" class="form-label fw-semibold">Skills</label>
                            <textarea class="form-control" id="skills" name="skills" rows="3" 
                                      placeholder="Separate skills with commas: Python, JavaScript, React, Node.js, MySQL, Docker, AWS, Project Management, Team Leadership">{{ cv.skills if edit_mode else '' }}</textarea>
                            <div class="form-text">Separate each skill with a comma.</div>
                        </div>

                        <!-- Projects -->
                        <div class="section-header mb-4">
                            <h4 class="fw-bold text-primary">
                                <i class="fas fa-project-diagram me-2"></i>Projects
                            </h4>
                            <hr class="mt-2">
                        </div>
                        
                        <div class="mb-4">
                            <label for="projects" class="form-label fw-semibold">Projects</label>
                            <textarea class="form-control" id="projects" name="projects" rows="6" 
                                      placeholder="Project Name | Technology Stack | Link (optional)
Brief description of the project and your role
• Key feature or achievement
• Another technical challenge solved
• Impact or results achieved

Project Name | Technology Stack | Link (optional)
Brief description of the project and your role">{{ cv.projects if edit_mode else '' }}</textarea>
                            <div class="form-text">Format: Project Name | Tech Stack | Link, then describe your contributions.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Column -->
            <div class="col-lg-4">
                <div class="sticky-top" style="top: 100px;">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0 fw-bold text-primary">
                                <i class="fas fa-eye me-2"></i>Live Preview
                            </h5>
                        </div>
                        <div class="card-body p-3">
                            <div id="cvPreview" class="cv-preview">
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-file-alt fa-3x mb-3"></i>
                                    <p>Fill out the form to see your CV preview</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-save me-2"></i>{{ 'Update CV' if edit_mode else 'Create CV' }}
                        </button>
                        {% if edit_mode %}
                            <a href="{{ url_for('view_cv', cv_id=cv.id) }}" class="btn btn-outline-secondary w-100 mt-2">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Live preview functionality
function updatePreview() {
    const title = document.getElementById('title').value;
    const fullName = document.getElementById('full_name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const address = document.getElementById('address').value;
    const summary = document.getElementById('summary').value;
    const websiteUrl = document.getElementById('website_url').value;
    const linkedinUrl = document.getElementById('linkedin_url').value;
    const githubUrl = document.getElementById('github_url').value;
    const skills = document.getElementById('skills').value;

    if (!fullName && !email && !title) {
        document.getElementById('cvPreview').innerHTML = `
            <div class="text-center text-muted py-4">
                <i class="fas fa-file-alt fa-3x mb-3"></i>
                <p>Fill out the form to see your CV preview</p>
            </div>`;
        return;
    }

    let previewHTML = `
        <div class="cv-preview-content">
            ${title ? `<h6 class="text-primary fw-bold mb-2">${title}</h6>` : ''}
            ${fullName ? `<h5 class="fw-bold mb-1">${fullName}</h5>` : ''}
            ${email ? `<p class="text-muted small mb-1"><i class="fas fa-envelope me-1"></i>${email}</p>` : ''}
            ${phone ? `<p class="text-muted small mb-1"><i class="fas fa-phone me-1"></i>${phone}</p>` : ''}
            ${address ? `<p class="text-muted small mb-3"><i class="fas fa-map-marker-alt me-1"></i>${address}</p>` : ''}
            
            ${summary ? `
                <div class="mb-3">
                    <h6 class="fw-bold text-primary">Summary</h6>
                    <p class="small">${summary.substring(0, 100)}${summary.length > 100 ? '...' : ''}</p>
                </div>
            ` : ''}
            
            <div class="mb-3">
                <h6 class="fw-bold text-primary">Links</h6>
                <div class="d-flex flex-wrap gap-2">
                    ${websiteUrl ? `<span class="badge bg-primary"><i class="fas fa-globe me-1"></i>Website</span>` : ''}
                    ${linkedinUrl ? `<span class="badge bg-info"><i class="fab fa-linkedin me-1"></i>LinkedIn</span>` : ''}
                    ${githubUrl ? `<span class="badge bg-dark"><i class="fab fa-github me-1"></i>GitHub</span>` : ''}
                </div>
            </div>
            
            ${skills ? `
                <div class="mb-3">
                    <h6 class="fw-bold text-primary">Skills</h6>
                    <div class="d-flex flex-wrap gap-1">
                        ${skills.split(',').slice(0, 4).map(skill => 
                            `<span class="badge bg-light text-dark">${skill.trim()}</span>`
                        ).join('')}
                        ${skills.split(',').length > 4 ? '<span class="badge bg-secondary">...</span>' : ''}
                    </div>
                </div>
            ` : ''}
            
            <div class="text-center mt-3">
                <div class="bg-light p-2 rounded">
                    <i class="fas fa-qrcode fa-2x text-primary"></i>
                    <p class="small text-muted mb-0 mt-1">QR Code will appear here</p>
                </div>
            </div>
        </div>`;

    document.getElementById('cvPreview').innerHTML = previewHTML;
}

// Add event listeners for live preview
document.addEventListener('DOMContentLoaded', function() {
    const formInputs = document.querySelectorAll('#cvForm input, #cvForm textarea');
    formInputs.forEach(input => {
        input.addEventListener('input', updatePreview);
    });
    
    // Initial preview update
    updatePreview();
});

// Form validation
document.getElementById('cvForm').addEventListener('submit', function(e) {
    const title = document.getElementById('title').value.trim();
    const fullName = document.getElementById('full_name').value.trim();
    const email = document.getElementById('email').value.trim();
    
    if (!title || !fullName || !email) {
        e.preventDefault();
        alert('Please fill in all required fields (Title, Full Name, and Email).');
        return false;
    }
});
</script>
{% endblock %}